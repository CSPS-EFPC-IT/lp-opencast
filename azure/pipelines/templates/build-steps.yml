parameters:
- name: buildNumber
  type: string
- name: buildSourceBranchName
  type: string
- name: componentNames
  type: object
  default:
    - admin
    - presentation
    - worker
- name: containerRegistryConnection
  type: string
- name: containerRepositoryBaseName
  type: string

steps:

- ${{ each component in parameters.componentNames }}:
  - task: Docker@2
    displayName: 'Build ${{ component }} container'
    inputs:
      containerRegistry: ${{ parameters.containerRegistryConnection }}
      repository: '${{ parameters.containerRepositoryBaseName }}/${{ component }}'
      command: 'buildAndPush'
      Dockerfile: 'lp-opencast/docker/opencast-${{ component }}/Dockerfile'
      buildContext: 'lp-opencast'
      tags: |
        'latest_${{ parameters.buildSourceBranchName }}'
        '${{ parameters.buildNumber }}_${{ parameters.buildSourceBranchName }}'