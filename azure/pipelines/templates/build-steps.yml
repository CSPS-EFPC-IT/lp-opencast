parameters:
- name: buildNumber
  type: string
- name: containerRegistryConnection
  type: string
- name: containerRepository
  type: string

steps:

- task: Docker@2
  displayName: 'Build admin container'
  inputs:
    containerRegistry: '${{ parameters.containerRegistryConnection }}'
    repository: '${{ parameters.containerRepository }}-admin'
    command: 'buildAndPush'
    Dockerfile: 'lp-opencast/docker/opencast-admin/Dockerfile'
    buildContext: 'lp-opencast'
    tags: |
      latest
      ${{ parameters.buildNumber }}

- task: Docker@2
  displayName: 'Build presentation container'
  inputs:
    containerRegistry: '${{ parameters.containerRegistryConnection }}'
    repository: '${{ parameters.containerRepository }}-presentation'
    command: 'buildAndPush'
    Dockerfile: 'lp-opencast/docker/opencast-presentation/Dockerfile'
    buildContext: 'lp-opencast'
    tags: |
      latest
      ${{ parameters.buildNumber }}

- task: Docker@2
  displayName: 'Build worker container'
  inputs:
    containerRegistry: '${{ parameters.containerRegistryConnection }}'
    repository: '${{ parameters.containerRepository }}-worker'
    command: 'buildAndPush'
    Dockerfile: 'lp-opencast/docker/opencast-worker/Dockerfile'
    buildContext: 'lp-opencast'
    tags: |
      latest
      ${{ parameters.buildNumber }}